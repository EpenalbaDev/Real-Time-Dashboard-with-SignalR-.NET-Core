# Cursor Rules — Real-Time Dashboard SignalR

## Context
Building a real-time financial transaction dashboard with Blazor Server + SignalR + MySQL.
This is a public demo project for a technical blog article. Code quality matters.

## Stack
- .NET 8, Blazor Server, SignalR (built-in)
- MySQL 8.0 via Pomelo EF Core provider
- Chart.js via JS Interop
- xUnit + bUnit for tests

## Key Patterns
- **Batched SignalR:** Never send per-transaction updates. Aggregate and broadcast every 500ms.
- **Channel<T>:** Use System.Threading.Channels for producer-consumer between services.
- **Pre-computed metrics:** MetricsAggregator computes summaries; dashboard reads cached results.
- **Typed hub:** Always use `IDashboardClient` interface, never raw `SendAsync`.

## Code Style
- Use `sealed` on all classes unless designed for inheritance
- Use `record` for DTOs and immutable types
- Async all the way — never `.Result` or `.Wait()`
- `ILogger<T>` with structured logging (no string interpolation in log templates)
- Nullable reference types enabled project-wide
- No `#region` blocks
- Max 200 lines per file — split if larger

## File Naming
- Entities: `TransactionEntity.cs` (suffix Entity)
- DTOs: `TransactionDto.cs` (suffix Dto)
- Services: `TransactionService.cs` (no suffix on interface: `ITransactionService`)
- Blazor: `Dashboard.razor` + `Dashboard.razor.cs` (code-behind)

## When Generating Code
- Always add XML docs on public methods
- Always add `CancellationToken` parameter to async methods
- Always use `ConfigureAwait(false)` in library-style code (services), not in Blazor components
- Prefer `ValueTask` over `Task` for hot paths that often complete synchronously

## Testing
- One test class per service
- Use descriptive test names: `Should_BatchTransactions_When_BufferFull`
- Mock with `NSubstitute`, not `Moq`
- Integration tests use `WebApplicationFactory<Program>`

## Don't
- Don't add authentication (documented as "production would add")
- Don't use Redis (document as scaling path)
- Don't add Swagger/OpenAPI (no REST API exposed)
- Don't use MediatR (overkill for this scope)
- Don't add FluentValidation (simple validation inline)
