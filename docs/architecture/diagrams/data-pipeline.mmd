graph LR
    subgraph "Transaction Generation"
        GEN["TransactionProcessor<br/>BackgroundService"]
        GEN_RATE["Configurable TPS<br/>(default: 10)"]
    end

    subgraph "Internal Message Bus"
        CH["Channel&lt;TransactionEntity&gt;<br/>BoundedChannel(10K)<br/>FullMode: Wait"]
    end

    subgraph "Database Pipeline"
        BATCH["Internal Batch Buffer<br/>List&lt;T&gt; + lock"]
        FLUSH["PeriodicFlush<br/>Every 1 second"]
        DB[(MySQL 8.0<br/>Transactions table)]
    end

    subgraph "Broadcast Pipeline"
        BC["DashboardBroadcaster<br/>PeriodicTimer 500ms"]
        BUF["Batch Buffer<br/>Drain channel → List"]
    end

    subgraph "Metrics Pipeline"
        MA["MetricsAggregator<br/>PeriodicTimer 500ms"]
        CACHE["IMemoryCache<br/>TTL: 5s"]
    end

    subgraph "SignalR Delivery"
        HUB["DashboardHub<br/>Hub&lt;IDashboardClient&gt;"]
        WS1["WebSocket → Client 1"]
        WS2["WebSocket → Client 2"]
        WSN["WebSocket → Client N"]
    end

    subgraph "Client Rendering"
        BLAZOR["Blazor Components"]
        CHARTJS["Chart.js<br/>via JS Interop"]
        DOM["DOM Update<br/>StateHasChanged()"]
    end

    GEN -->|"Produce txn"| CH
    GEN -->|"Add to batch"| BATCH
    BATCH -->|"Flush every 1s"| FLUSH
    FLUSH -->|"SaveChangesAsync"| DB

    CH -->|"TryRead()"| BUF
    BUF --> BC
    MA -->|"SELECT last 1hr"| DB
    MA -->|"Cache.Set()"| CACHE
    BC -->|"Read cached"| CACHE
    BC -->|"SendAll(batch + metrics)"| HUB

    HUB --> WS1
    HUB --> WS2
    HUB --> WSN

    WS1 --> BLAZOR
    BLAZOR --> CHARTJS
    BLAZOR --> DOM

    style GEN fill:#4CAF50,color:#fff
    style CH fill:#FFC107,color:#000
    style DB fill:#607D8B,color:#fff
    style BC fill:#9C27B0,color:#fff
    style MA fill:#2196F3,color:#fff
    style HUB fill:#F44336,color:#fff
    style CACHE fill:#00BCD4,color:#fff
    style CHARTJS fill:#FF9800,color:#fff
