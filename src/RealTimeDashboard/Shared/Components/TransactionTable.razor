@namespace RealTimeDashboard.Shared.Components
@using RealTimeDashboard.Data.Entities
@using RealTimeDashboard.Models
@inject ILocalizationService Loc

<div class="card">
    <h3>@Loc.Get("table.recentTransactions")</h3>
    <div class="txn-table-container">
        <table class="txn-table">
            <thead>
                <tr>
                    <th>@Loc.Get("table.id")</th>
                    <th>@Loc.Get("table.amount")</th>
                    <th>@Loc.Get("table.type")</th>
                    <th>@Loc.Get("table.source")</th>
                    <th>@Loc.Get("table.status")</th>
                    <th>@Loc.Get("table.time")</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var txn in Transactions)
                {
                    <tr class="@(IsNew(txn) ? "new-row" : "")">
                        <td><code>@txn.TransactionId[..8]</code></td>
                        <td class="amount">@txn.Amount.ToString("C")</td>
                        <td><span class="badge-type">@txn.Type</span></td>
                        <td>@txn.Source</td>
                        <td><span class="badge-status @GetStatusClass(txn.Status)">@txn.Status</span></td>
                        <td>@txn.CreatedAt.LocalDateTime.ToString("HH:mm:ss")</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@code {
    [Parameter, EditorRequired] public IReadOnlyList<TransactionDto> Transactions { get; set; } = [];
    [Parameter] public HashSet<string>? NewTransactionIds { get; set; }
    [CascadingParameter(Name = "Lang")] public string? Lang { get; set; }

    private bool IsNew(TransactionDto txn) =>
        NewTransactionIds?.Contains(txn.TransactionId) == true;

    private static string GetStatusClass(TransactionStatus status) => status switch
    {
        TransactionStatus.Completed => "badge-completed",
        TransactionStatus.Pending => "badge-pending",
        TransactionStatus.Processing => "badge-processing",
        TransactionStatus.Failed => "badge-failed",
        TransactionStatus.Flagged => "badge-flagged",
        _ => ""
    };
}
